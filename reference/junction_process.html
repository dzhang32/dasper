<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Processing junctions — junction_annot • dasper</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Processing junctions — junction_annot" />
<meta property="og:description" content="The set of functions prefixed with &quot;junction_&quot; are used to
process junction data. They are designed to be run in a sequential manner
in the order junction_annot, junction_filter, junction_norm,
junction_score. Or, alternatively the wrapper function junction_process
can be used to run all 4 of the functions stated above in one go. For more
details of the individual functions, see &quot;Details&quot;." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dasper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/dasper.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dzhang32/dasper/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Processing junctions</h1>
    <small class="dont-index">Source: <a href='https://github.com/dzhang32/dasper/blob/master/R/junction_annot.R'><code>R/junction_annot.R</code></a>, <a href='https://github.com/dzhang32/dasper/blob/master/R/junction_filter.R'><code>R/junction_filter.R</code></a>, <a href='https://github.com/dzhang32/dasper/blob/master/R/junction_norm.R'><code>R/junction_norm.R</code></a>, and 2 more</small>
    <div class="hidden name"><code>junction_process.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The set of functions prefixed with "junction_" are used to
process junction data. They are designed to be run in a sequential manner
in the order <code>junction_annot</code>, <code>junction_filter</code>, <code>junction_norm</code>,
<code>junction_score</code>. Or, alternatively the wrapper function <code>junction_process</code>
can be used to run all 4 of the functions stated above in one go. For more
details of the individual functions, see "Details".</p>
    </div>

    <pre class="usage"><span class='fu'>junction_annot</span><span class='op'>(</span><span class='va'>junctions</span>, <span class='va'>ref</span><span class='op'>)</span>

<span class='fu'>junction_filter</span><span class='op'>(</span>
  <span class='va'>junctions</span>,
  count_thresh <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>raw <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,
  n_samp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>raw <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
  width_range <span class='op'>=</span> <span class='cn'>NULL</span>,
  types <span class='op'>=</span> <span class='cn'>NULL</span>,
  regions <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>junction_norm</span><span class='op'>(</span><span class='va'>junctions</span><span class='op'>)</span>

<span class='fu'>junction_process</span><span class='op'>(</span>
  <span class='va'>junctions</span>,
  <span class='va'>ref</span>,
  count_thresh <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>raw <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>,
  n_samp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>raw <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
  width_range <span class='op'>=</span> <span class='cn'>NULL</span>,
  types <span class='op'>=</span> <span class='cn'>NULL</span>,
  regions <span class='op'>=</span> <span class='cn'>NULL</span>,
  score_func <span class='op'>=</span> <span class='va'>.zscore</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>junction_score</span><span class='op'>(</span><span class='va'>junctions</span>, score_func <span class='op'>=</span> <span class='va'>.zscore</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>junctions</th>
      <td><p>junction data as a
<a href='https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html'>RangedSummarizedExperiment-class</a>
object.</p></td>
    </tr>
    <tr>
      <th>ref</th>
      <td><p>either path to gtf/gff3 or object of class
<a href='https://rdrr.io/pkg/GenomicFeatures/man/TxDb-class.html'>TxDb-class</a>.</p></td>
    </tr>
    <tr>
      <th>count_thresh</th>
      <td><p>named vector with names matching the names of the
<a href='https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html'>assays</a> in <code>junctions</code>.
Values denote the number of counts below which a junction will be filtered
out.</p></td>
    </tr>
    <tr>
      <th>n_samp</th>
      <td><p>named vector with names matching the names of the
<a href='https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html'>assays</a> in <code>junctions</code>.
Values denotes number of samples that have to express the junction above
the <code>count_thresh</code> in order for that junction to not be filtered.</p></td>
    </tr>
    <tr>
      <th>width_range</th>
      <td><p>numeric vector of length 2. The first element denoting the
lower limit of junction width and the second the upper limit. Junctions
with widths outside this range will be filtered out.</p></td>
    </tr>
    <tr>
      <th>types</th>
      <td><p>any junctions matching these types, derived form
junction_annot will be filtered out.</p></td>
    </tr>
    <tr>
      <th>regions</th>
      <td><p>any junctions overlapping this set of regions (in a
<a href='https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html'>GRanges-class</a> format) will be filtered out.</p></td>
    </tr>
    <tr>
      <th>score_func</th>
      <td><p>function to score junctions by their abnormality. By
default, will use a z-score but can be switched to a user-defined function.
This function must take as input an <code>x</code> and <code>y</code> argument, containing case
and control counts respectively. This must return a numeric vector equal to
the length of <code>x</code> with elements corresponding to a abnormality of each
junction.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to <code>score_func</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><a href='https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html'>RangedSummarizedExperiment-class</a>
object containing filtered, annotated, normalised junction data with
abnormality scores.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>junction_process</code> wraps all "junction_" prefixed functions in
<a href='dasper.html'>dasper</a> except <a href='junction_load.html'>junction_load</a>. This is designed to
simplify processing of the junction data for those familiar or uninterested
with the intermediates.</p>
<p><code>junction_annot</code> annotates junctions by 1. whether their start and/or end
position precisely overlaps with an annotated exon boundary and 2. whether
that junction matches an intron definition from existing annotation. Using
this information along with the strand, junctions are categorised into
"annotated", "novel_acceptor", "novel_donor", "novel_combo",
"novel_exon_skip", "ambig_gene" and "unannotated".</p>
<p><code>junction_filter</code> filters out "noisy" junctions based on counts, the width
of junctions, annotation category of the junction returned from
junction_annot and whether the junction overlaps with a set of
(blacklist) regions.</p>
<p><code>junction_norm</code> normalises the raw junction counts by 1. building junction
clusters by finding junctions that share an acceptor or donor position and
2. calculating a proportion-spliced-in (PSI) for each junction by dividing
the raw junction count by the total number of counts in it's associated
cluster.</p>
<p><code>junction_score</code> will use the counts contained within the "norm"
<a href='https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html'>assay</a> to calculate a
deviation of each patient junction from the expected distribution of
control junction counts. The function used to calculate this abnormality
score can be user-inputted or left as the default z-score. Junctions will
also be labelled based on whether they are up-regulated (+1) or
down-regulated (-1) with respect to controls junction and this information
is stored in the <a href='https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html'>assay</a>
"direction" for use in <a href='outlier_aggregate.html'>outlier_aggregate</a>.</p>
    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    
<ul>
<li><p><code>junction_annot</code>: Annotate junctions using reference annotation</p></li>
<li><p><code>junction_filter</code>: Filter junctions by count, width, annotation or region</p></li>
<li><p><code>junction_norm</code>: Normalise junction counts by cluster</p></li>
<li><p><code>junction_score</code>: Score patient junctions by their abnormality</p></li>
</ul>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>ENCODE blacklist regions are recommended to be included as <code>regions</code>
for <code>junction_filter</code> and can be downloaded from
<a href='https://github.com/Boyle-Lab/Blacklist/blob/master/lists/hg38-blacklist.v2.bed.gz'>https://github.com/Boyle-Lab/Blacklist/blob/master/lists/hg38-blacklist.v2.bed.gz</a>.
Further information can be found via the publication
<a href='https://www.nature.com/articles/s41598-019-45839-z'>https://www.nature.com/articles/s41598-019-45839-z</a>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>##### Set up txdb #####</span>

<span class='co'># use GenomicState to load txdb (GENCODE v31)</span>
<span class='va'>ref</span> <span class='op'>&lt;-</span> <span class='fu'>GenomicState</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/GenomicState/man/GenomicStateHub.html'>GenomicStateHub</a></span><span class='op'>(</span>
    version <span class='op'>=</span> <span class='st'>"31"</span>,
    genome <span class='op'>=</span> <span class='st'>"hg38"</span>,
    filetype <span class='op'>=</span> <span class='st'>"TxDb"</span>
<span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
</div><div class='output co'>#&gt; <span class='message'>snapshotDate(): 2020-04-27</span></div><div class='output co'>#&gt; <span class='message'>loading from cache</span></div><div class='input'>
<span class='co'>##### junction_annot #####</span>

<span class='va'>junctions</span> <span class='op'>&lt;-</span> <span class='fu'>junction_annot</span><span class='op'>(</span><span class='va'>junctions_example</span>, <span class='va'>ref</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "2020-10-20 00:10:40 - Obtaining co-ordinates of annotated exons and junctions from gtf/gff3..."
#&gt; [1] "2020-10-20 00:10:55 - Getting junction annotation using overlapping exons..."
#&gt; [1] "2020-10-20 00:10:58 - Tidying junction annotation..."
#&gt; [1] "2020-10-20 00:10:58 - Deriving junction categories..."
#&gt; [1] "2020-10-20 00:11:04 - done!"</div><div class='input'>
<span class='co'>##### junction_filter #####</span>

<span class='va'>junctions</span> <span class='op'>&lt;-</span> <span class='fu'>junction_filter</span><span class='op'>(</span>
    <span class='va'>junctions</span>,
    types <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ambig_gene"</span>, <span class='st'>"unannotated"</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "2020-10-20 00:11:04 - Filtering junctions..."
#&gt; [1] "2020-10-20 00:11:04 - by count..."
#&gt; [1] "2020-10-20 00:11:05 - by type..."
#&gt; [1] "2020-10-20 00:11:05 - done!"</div><div class='input'>
<span class='co'>##### junction_norm #####</span>

<span class='va'>junctions</span> <span class='op'>&lt;-</span> <span class='fu'>junction_norm</span><span class='op'>(</span><span class='va'>junctions</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "2020-10-20 00:11:05 - Clustering junctions..."
#&gt; [1] "2020-10-20 00:11:05 - Normalising junction counts..."
#&gt; [1] "2020-10-20 00:11:05 - done!"</div><div class='input'>
<span class='co'>##### junction_score #####</span>

<span class='va'>junctions</span> <span class='op'>&lt;-</span> <span class='fu'>junction_score</span><span class='op'>(</span><span class='va'>junctions</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "2020-10-20 00:11:05 - Calculating the direction of change of junctions..."
#&gt; [1] "2020-10-20 00:11:05 - Generating junction abnormality score..."
#&gt; [1] "2020-10-20 00:11:06 - done!"</div><div class='input'>
<span class='co'>##### junction_process #####</span>

<span class='va'>junctions_processed</span> <span class='op'>&lt;-</span> <span class='fu'>junction_process</span><span class='op'>(</span>
    <span class='va'>junctions_example</span>,
    <span class='va'>ref</span>,
    types <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ambig_gene"</span>, <span class='st'>"unannotated"</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "# Filtering junctions -----------------------------------------------------"
#&gt; [1] "2020-10-20 00:11:06 - Filtering junctions..."
#&gt; [1] "2020-10-20 00:11:06 - by count..."
#&gt; [1] "2020-10-20 00:11:06 - done!"
#&gt; [1] "# Annotating junctions ----------------------------------------------------"
#&gt; [1] "2020-10-20 00:11:06 - Obtaining co-ordinates of annotated exons and junctions from gtf/gff3..."
#&gt; [1] "2020-10-20 00:11:23 - Getting junction annotation using overlapping exons..."
#&gt; [1] "2020-10-20 00:11:24 - Tidying junction annotation..."
#&gt; [1] "2020-10-20 00:11:25 - Deriving junction categories..."
#&gt; [1] "2020-10-20 00:11:25 - done!"
#&gt; [1] "# Filtering junctions -----------------------------------------------------"
#&gt; [1] "2020-10-20 00:11:25 - Filtering junctions..."
#&gt; [1] "2020-10-20 00:11:25 - by type..."
#&gt; [1] "2020-10-20 00:11:25 - done!"
#&gt; [1] "# Normalise junctions -----------------------------------------------------"
#&gt; [1] "2020-10-20 00:11:25 - Clustering junctions..."
#&gt; [1] "2020-10-20 00:11:25 - Normalising junction counts..."
#&gt; [1] "2020-10-20 00:11:25 - done!"
#&gt; [1] "# Score junctions ---------------------------------------------------------"
#&gt; [1] "2020-10-20 00:11:25 - Calculating the direction of change of junctions..."
#&gt; [1] "2020-10-20 00:11:25 - Generating junction abnormality score..."
#&gt; [1] "2020-10-20 00:11:25 - done!"</div><div class='input'>
<span class='co'># the two objects are equivalent</span>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>junctions_processed</span>, <span class='va'>junctions</span>, check.attributes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Zhang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


